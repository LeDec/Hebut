<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>匠心训练项目</title>
    <script type="text/javascript" src="js/jquery-3.2.1.js"></script>
    <!--    兼容浏览器、整体布局-->
    <link rel="stylesheet" href="./css/content.css">
    <!--    头部导航栏-->
    <link rel="stylesheet" href="./css/headNav.css">
    <!--    左侧导航栏样式-->
    <link rel="stylesheet" href="./css/leftNav.css">
    <!--右侧导航栏样式-->
    <link rel="stylesheet" href="./css/rightNav.css">
    <!--    右侧列表样式-->
    <link rel="stylesheet" href="./css/rightForm.css">
    <!--    右侧菜单样式-->
    <link rel="stylesheet" href="./css/rightMenu.css">
    <!--    按钮样式-->
    <link rel="stylesheet" href="./css/button.css">
    <!--    左侧导航栏js-->
    <script type="text/javascript" src="js/leftNav.js"></script>
    <!--    消息提醒红点-->
    <script type="text/javascript" src="js/news.js"></script>
    <!--    放缩格式-->
    <script type="text/javascript" src="js/scale.js"></script>
    <script src="http://apps.bdimg.com/libs/jquery/2.1.1/jquery.min.js"></script>
    <script src="../tinymce/tinymce.min.js"></script>

    <script >
        tinymce.init({
            selector: '#tinydemo',
            language:'zh_CN',
            // toolbar: 'image',
            height:'700px',
            resize:false,
            plugins: 'link image',
            images_upload_url: 'http://'+localStorage.getItem('IP')+':'+localStorage.getItem('port')+'/project/inform-attachment/fileAttachment', //用于指定一个接收上传文件的后端处理程序地址
            // images_upload_base_path: 'J', //如果返回的地址是相对路径，此参数可以给相对路径指定它所相对的基本路径
            // file_browser_callback_types: 'file image media',//这个根据个人需要配置
            // file_picker_callback: function(callback, value, meta) {
            //     //文件分类
            //     var filetype = '.pdf, .txt, .zip, .rar, .7z, .doc, .docx, .xls, .xlsx, .ppt, .pptx, .mp3, .mp4';
            //     var upurl = 'http://'+localStorage.getItem('IP')+':'+localStorage.getItem('port')+'/project/inform-attachment/fileAttachment';
            //     //为不同插件指定文件类型及后端地址
            //     switch (meta.filetype) {
            //         case 'image':
            //             filetype = '.jpg, .jpeg, .png, .gif';
            //             break;
            //         case 'media':
            //             filetype = '.mp3, .mp4';
            //             break;
            //         case 'file':
            //             break;
            //     };
            //     //模拟出一个input用于添加本地文件
            //     var input = document.createElement('input');
            //     input.setAttribute('type', 'file');
            //     input.setAttribute('accept', filetype);
            //     input.click();
            //     input.onchange = function() {
            //         var file = this.files[0];
            //
            //         var xhr, formData;
            //         console.log(file.name);
            //         xhr = new XMLHttpRequest();
            //         xhr.withCredentials = false;
            //         xhr.open('POST', upurl);
            //         xhr.onload = function() {
            //             var json;
            //             if (xhr.status != 200) {
            //                 failure('HTTP Error: ' + xhr.status);
            //                 return;
            //             }
            //             json = JSON.parse(xhr.responseText);
            //             if (!json || typeof json.location != 'string') {
            //                 failure('Invalid JSON: ' + xhr.responseText);
            //                 return;
            //             }
            //             callback(json.location);
            //         };
            //         formData = new FormData();
            //         formData.append('file', file, file.name );
            //         xhr.send(formData)
            //     };
            // },
        });
    </script>
</head>

<body>

<ul>
    <li><a class="active" href="headmaster.html">匠心训练营</a></li>
    <li style="float:right"><a class="active" href="myInformation.html"><img src="图片/我的头像.png" height="33px" width="33px"></a></li>
    <li style="float:right"><a class="active" href="myNews.html"><img src="图片/消息.png" id="XiaoXi" width="33px" height="33px"></a></li>
</ul>



<div class="content">
    <div class="content-left">
        <!--菜单栏导航-->
        <div class="nav">
            <!--每一个菜单项-->
            <div class="nav-menu">
                <!--主标题-->
                <div class="nav-title"><a href="headmaster.html"> <img src="图片/主页.png" width="17px" height="17px" style="position:relative;left:-40px;top:3px">主页</a></div>
            </div>
            <!--分割线-->
            <div class="seg"></div>

            <div class="nav-menu">
                <!--主标题-->
                <div class="nav-title"><a href="studentRegistrationReview.html"><img src="./图片/报名审核.png" width="17px" height="17px" style="position:relative;left:-26px;top:3px">报名审核</a></div>
            </div>
            <!--分割线-->
            <div class="seg"></div>

            <div class="nav-menu">
                <!--主标题-->
                <div class="nav-title"><img src="图片/学生管理.png" width="17px" height="17px" style="position:relative;left:-26px;top:3px">学生管理</div>
                <div class="nav-content">
                    <a href="studentPersonalInformation.html">学生信息</a>
                </div>
            </div>

            <!--分割线-->
            <div class="seg"></div>

            <div class="nav-menu">
                <!--主标题-->
                <div class="nav-title"><img src="图片/过程管理.png" width="17px" height="17px" style="position:relative;left:-26px;top:3px">过程管理</a></div>
                <div class="nav-content">
                    <a href="stageOne.html">中期阶段</a>
                    <a href="stageTwo.html">答辩阶段</a>
                    <a href="stageThree.html">后期成果</a>
                </div>
            </div>
            <!--分割线-->
            <div class="seg"></div>

            <div class="nav-menu">
                <!--主标题-->
                <div class="nav-title"><img src="图片/成绩管理.png" width="17px" height="17px" style="position:relative;left:-26px;top:3px">成绩管理</div>
                <div class="nav-content">
                    <a href="scoreEvaluation.html">成绩评定</a>
                    <a href="lookScore.html">查看成绩</a>
                </div>
            </div>
            <!--分割线-->
            <div class="seg"></div>

            <div class="nav-menu">
                <!--主标题-->
                <div class="nav-title"><img src="./图片/报销审核.png" width="17px" height="17px" style="position:relative;left:-26px;top:3px">报销管理</div>
                <div class="nav-content">
                    <a href="reimBursementReview_Project.html">查看报销</a>
                    <a href="reimBursementReviewLook.html">审核报销</a>
                </div>
            </div>
            <!--分割线-->
            <div class="seg"></div>

            <div class="nav-menu">
                <!--主标题-->
                <div class="nav-title"><a href="teachingEvaluation.html"><img src="./图片/教评管理.png" width="17px" height="17px" style="position:relative;left:-26px;top:3px">教评管理</a></div>
            </div>
            <div class="seg"></div>

            <div class="nav-menu">
                <!--主标题-->
                <div class="nav-title"><img src="./图片/通知管理图标.png" width="17px" height="17px" style="position:relative;left:-26px;top:3px">通知管理</div>
                <div class="nav-contentt">
                    <a href="publishNews.html" style="background:#87CEFA">发布通知</a>
                    <a href="manageNews.html">查看通知</a>
                </div>
            </div>
            <!--分割线-->
            <div class="seg"></div>

            <div class="nav-menu">
                <!--主标题-->
                <div class="nav-title"><a href="batch.html"><img src="./图片/报名审核.png" width="17px" height="17px" style="position:relative;left:-26px;top:3px">往届匠心班</a></div>
            </div>

        </div>
    </div>

    <!--  右侧导航条-->
    <div id="firstpaneDiv" class="menu_list">
        <h3 class="menu_head current" id="dao">发布通知</h3>
    </div>
    <!--右侧内容区-->
    <div class="content-right">
        <div style="display:block" class="menu_nva">
            接收用户：<select id="userTypeId" style="width:188px;" onmousedown="if(options.length>6){size=5}" onchange="size=0" onclick="getIntype()">
            <option value="" disabled selected hidden>请选择发送到的用户类型</option>
            <option value="2">班主任</option>
            <option value="3">指导教师</option>
            <option value="4">专家评委</option>
            <option value="5">学生</option>
            <option value="6">企业</option>
        </select>
            </br>
            通知标题：<input id="title" style="width:300px"/>
            </br>
            <div id = "tinydemo"></div>
            <a style="float:right">
                <form id="uploadForm" enctype="multipart/form-data" >
                    图片附件(非必选)： <input multiple type="file" name="file" id="certificate">
                </form>
            </a>
            <div  class="login-form">
                <button onclick="submit(this)">发送</button>

            </div>
        </div>
    </div>
</div>

<script type="text/javascript">
// 上传附件图片方法
          var fileIsNull = true;
         $('#certificate').on('change', function () {

            if (this.value != "") {   // 判断用户是否选中了文件
                fileIsNull=false;
            } else {
                alert("请选择文件")
            }

         })

     function submit(btn) {
                var formData = new FormData($('#uploadForm')[0]);
                $.ajax({
                    type: 'post',
                    url: 'http://'+localStorage.getItem('IP')+':'+localStorage.getItem('port')+"/project/inform-attachment/fileAttachment",
                    data: formData,
                    cache: false,
                    processData: false,
                    contentType: false,
                    dataType:"JSON"
                    })
                    .success(function (data) {
                    if(data.code==0){
                    localStorage.setItem('materialId', data.msg);
                    localStorage.setItem('flag', 1);
                    }
                    else
                    localStorage.setItem('flag', 0);
                    complete();
                    })
                    .error(function () {
                        alert("上传失败");
                    });
            }

    function complete(){
    if(localStorage.getItem('flag')==1)
    {
    $.ajax({
        url: 'http://'+localStorage.getItem('IP')+':'+localStorage.getItem('port')+'/project/inform/setSomeInform',
        data: JSON.stringify({
              "type": $("#userTypeId").find("option:selected").val(),
              "attachment": [localStorage.getItem('materialId')],
              "information": tinyMCE.activeEditor.getContent(),
              "senderId": localStorage.getItem('userId'),
              "title": $("#title").val()
        }),
        contentType: 'application/json',
        type: 'post',
        dataType: 'json',
        success:function (data){
        if(data.code==0)
        {
         alert('发送成功！');
        window.location.href="publishNews.html";
        }
        else
        alert(data.msg);
        }
    })
    }
    else
    {
     $.ajax({
        url: 'http://'+localStorage.getItem('IP')+':'+localStorage.getItem('port')+'/project/inform/setSomeInform',
        data: JSON.stringify({
              "type": $("#userTypeId").find("option:selected").val(),
              "attachment": [],
              "information": tinyMCE.activeEditor.getContent(),
              "senderId": localStorage.getItem('userId'),
              "title": $("#title").val()
        }),
        contentType: 'application/json',
        type: 'post',
        dataType: 'json',
        success:function (data){
        if(data.code==0){
        alert('发送成功！');
         window.location.href="publishNews.html";
        }

        else
        alert(data.msg);
        }
    })
    }


}
  </script>
</body>

</html>
<script>
    //body初始化事件
    //body标签加οnlοad='方法名()'
    //function 方法名(){
    //   初始化操作
    //   }
    function init(){
        //获取显示器宽度
        var widths=window.screen.width;
        //body的宽与显示器一致(浏览器最大化的时候可以用)
        document.body.style.width=widths+'px';
    }
    //监听浏览器的宽度变化
    window.onresize=function(){
        //获取浏览器当前的宽度
        var innerwidths =window.innerWidth;
        //获取当前显示器的宽度(一般情况下显示器的宽度是不会变得的)
        var widths=window.screen.width;

        //如果显示器宽度等于浏览器宽度那么这个情况大多数是最大化的时候
        if(innerwidths==widths){
            //所以直接把显示器的宽度赋给body
            document.body.style.width=widths+'px';
        }

        //如果浏览器的宽度不等于显示器的宽度时有两种情况
        // 第一种就是 缩小
        // 第二种就是 放大
        if(innerwidths!=widths){
            //先处理缩小的，因为浏览器在缩小的时候它的宽度会一直累加，这个时候浏览器宽度就大于显示器宽度了
            if (innerwidths>widths) {
                //这里给body赋值是模拟缩小页面的操作，幅度不能太大，要不然有点奇怪
                document.body.style.width=innerwidths*10%-widths*10%+'px';
                return;
            }

            //放大的操作就重新给body宽度赋显示器的宽度
            document.body.style.width=widths+'px';
        }
    }

</script>