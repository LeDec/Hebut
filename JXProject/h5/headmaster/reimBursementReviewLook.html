<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>报销审核</title>
    <script type="text/javascript" src="js/jquery-3.2.1.js"></script>
<!--    兼容浏览器、整体布局-->
    <link rel="stylesheet" href="./css/content.css">
<!--    头部导航栏-->
    <link rel="stylesheet" href="./css/headNav.css">
<!--    左侧导航栏样式-->
    <link rel="stylesheet" href="./css/leftNav.css">
<!--右侧导航栏-->
    <link rel="stylesheet" href="./css/rightNav.css">
<!--右侧列表-->
    <link rel="stylesheet" href="./css/rightForm.css">
<!--    按钮样式-->
    <link rel="stylesheet" href="./css/button.css">
    <!--    左侧导航栏js-->
    <script type="text/javascript" src="js/leftNav.js"></script>
    <!--    放缩格式-->
    <script type="text/javascript" src="js/scale.js"></script>
    <!--    分页条-->
    <link type="text/css" rel="stylesheet" href="css/page.css" >
    <script type="text/javascript" src="js/page.js"></script>
</head>
<body>
<ul>
    <li><a class="active" href="headmaster.html">匠心训练营</a></li>
    <li style="float:right"><a class="active" href="myInformation.html"><img src="图片/我的头像.png" height="33px" width="33px"></a></li>
    <li style="float:right"><a class="active" href="myNews.html"><img src="图片/消息.png" id="XiaoXi" width="33px" height="33px"></a></li>
</ul>

<div class="content">
    <div class="content-left">
        <!--菜单栏导航-->
        <div class="nav">
            <!--每一个菜单项-->
            <div class="nav-menu">
                <!--主标题-->
                <div class="nav-title"><a href="headmaster.html"> <img src="图片/主页.png" width="17px" height="17px" style="position:relative;left:-40px;top:3px">主页</a></div>
            </div>
            <!--分割线-->
            <div class="seg"></div>

            <div class="nav-menu">
                <!--主标题-->
                <div class="nav-title"><a href="studentRegistrationReview.html"><img src="./图片/报名审核.png" width="17px" height="17px" style="position:relative;left:-26px;top:3px">报名审核</a></div>
            </div>
            <!--分割线-->
            <div class="seg"></div>

            <div class="nav-menu">
                <!--主标题-->
                <div class="nav-title"><img src="图片/学生管理.png" width="17px" height="17px" style="position:relative;left:-26px;top:3px">学生管理</div>
                <div class="nav-content">
                    <a href="studentPersonalInformation.html">学生信息</a>
                </div>
            </div>

            <!--分割线-->
            <div class="seg"></div>

            <div class="nav-menu">
                <!--主标题-->
                <div class="nav-title"><img src="图片/过程管理.png" width="17px" height="17px" style="position:relative;left:-26px;top:3px">过程管理</a></div>
                <div class="nav-content">
                    <a href="stageOne.html">中期阶段</a>
                    <a href="stageTwo.html">答辩阶段</a>
                    <a href="stageThree.html">后期成果</a>
                </div>
            </div>
            <!--分割线-->
            <div class="seg"></div>

            <div class="nav-menu">
                <!--主标题-->
                <div class="nav-title"><img src="图片/成绩管理.png" width="17px" height="17px" style="position:relative;left:-26px;top:3px">成绩管理</div>
                <div class="nav-content">
                    <a href="scoreEvaluation.html">成绩评定</a>
                    <a href="lookScore.html">查看成绩</a>
                </div>
            </div>
            <!--分割线-->
            <div class="seg"></div>

            <div class="nav-menu">
                <!--主标题-->
                <div class="nav-title"><img src="./图片/报销审核.png" width="17px" height="17px" style="position:relative;left:-26px;top:3px">报销管理</div>
                <div class="nav-contentt">
                    <a href="reimBursementReview_Project.html">查看报销</a>
                    <a href="reimbursementReviewLook.html" style="background:#87CEFA">审核报销</a>
                </div>
            </div>
            <!--分割线-->
            <div class="seg"></div>

            <div class="nav-menu">
                <!--主标题-->
                <div class="nav-title"><a href="teachingEvaluation.html"><img src="./图片/教评管理.png" width="17px" height="17px" style="position:relative;left:-26px;top:3px">教评管理</a></div>
            </div>
            <div class="seg"></div>

            <div class="nav-menu">
                <!--主标题-->
                <div class="nav-title"><img src="./图片/通知管理图标.png" width="17px" height="17px" style="position:relative;left:-26px;top:3px">通知管理</div>
                <div class="nav-content">
                    <a href="publishNews.html">发布通知</a>
                    <a href="manageNews.html">查看通知</a>
                </div>
            </div>
            <!--分割线-->
            <div class="seg"></div>
            <div class="nav-menu">
                <!--主标题-->
                <div class="nav-title"><a href="batch.html"><img src="./图片/报名审核.png" width="17px" height="17px" style="position:relative;left:-26px;top:3px">往届匠心班</a></div>
            </div>
        </div>
    </div>
    <div id="firstpaneDiv" class="menu_list">
        <h3 class="menu_head current">报销查看</h3>
    </div>
    <!--右侧内容区-->
    <div class="content-right">
        <table id="yustb2">
            <tr>
                <th width="500">序号</th>
                <th width="500">编号</th>
                <th width="1200">项目名称</th>
                <th width="1000">申请日期</th>
                <th width="1800">报销内容</th>
                <th width="500">报销凭证</th>
                <th width="300">金额(元)</th>
                <th width="1000">审核</th>
            </tr>
        </table>
    </div>
</div>

<div id="pagination" style="position:relative;left:771px;bottom:99px;"></div>

</body>

</html>
<script>
var flag=0;
    $(function () {
        $.ajax({
            url: 'http://'+localStorage.getItem('IP')+':'+localStorage.getItem('port')+'/project/expense/checkAuditExpense',
            data: JSON.stringify({

                "commonRequest": {
                    "token": localStorage.getItem('token'),
                    "userId": localStorage.getItem('userId')
                },
                "pageRequest": {
                    "currentPage": 1,
                    "pageSize": 9
                }

            }),
            contentType: 'application/json',
            type: 'post',
            dataType: 'json',
            success: function (data) {
             //总页数设置
                                   Pagination.Init(document.getElementById('pagination'), {
                                       size: data.data.pages, // pages size
                                       page:1,// selected page
                                       step: 3   // pages before and after current
                                   });
var num=0;
                for (i in data.data.records) {
                    var tk;
                    num++;
                    voucher='<button onclick="load(this)" class="manage" value="'+data.data.records[i].expenseId+'">下载</button>',
                        Pass = '<button  onclick="yesPass(this)" class="yesId" value="'+data.data.records[i].expenseId+'">✔</button>',
                        nbsp = '<a>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp</a>',
                        nPass = '<button  onclick="noPass(this)" class="nId" value="'+data.data.records[i].expenseId+'">✘</button>',
                        tk ='<td>' + num + '</td>' +'<td>' + data.data.records[i].projectSymbol + '</td>' + '<td>' + data.data.records[i].projectName + '</td>' + '<td>' + data.data.records[i].expenseTime + '</td>'  + '<td>' + data.data.records[i].expenseIntroduction + '</td>' + '<td>' + voucher + '</td>'+ '<td>' + data.data.records[i].amount + '</td>' + '<td>' +Pass+nbsp+nPass+ '</td>'
                    $("#yustb2").append('<tr>' + tk + '</tr>')
                }

            }
        })

    })
     function Func() {
var num=0;
        $("#yustb2 tr:not(:first)").remove();//清空
    $.ajax({
            url: 'http://'+localStorage.getItem('IP')+':'+localStorage.getItem('port')+'/project/expense/checkAuditExpense',
            data: JSON.stringify({

                "commonRequest": {
                    "token": localStorage.getItem('token'),
                    "userId": localStorage.getItem('userId')
                },
                "pageRequest": {
                    "currentPage": Pagination.page,
                    "pageSize": 9
                }

            }),
            contentType: 'application/json',
            type: 'post',
            dataType: 'json',
            success: function (data) {
             //总页数设置
                                   Pagination.Init(document.getElementById('pagination'), {
                                       size: data.data.pages, // pages size
                                       page:Pagination.page,// selected page
                                       step: 3   // pages before and after current
                                   });
var num=0;
                for (i in data.data.records) {
                    var tk;
                    num++;
                    voucher='<button onclick="load(this)" class="manage" value="'+data.data.records[i].expenseId+'">下载</button>',
                        Pass = '<button  onclick="yesPass(this)" class="yesId" value="'+data.data.records[i].expenseId+'">✔</button>',
                        nbsp = '<a>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp</a>',
                        nPass = '<button  onclick="noPass(this)" class="nId" value="'+data.data.records[i].expenseId+'">✘</button>',
                        tk ='<td>' + num + '</td>' +'<td>' + data.data.records[i].projectSymbol + '</td>' + '<td>' + data.data.records[i].projectName + '</td>' + '<td>' + data.data.records[i].expenseTime + '</td>'  + '<td>' + data.data.records[i].expenseIntroduction + '</td>' + '<td>' + voucher + '</td>'+ '<td>' + data.data.records[i].amount + '</td>' + '<td>' +Pass+nbsp+nPass+ '</td>'
                    $("#yustb2").append('<tr>' + tk + '</tr>')
                }

            }
        })
    }

// 下载资料
         function load(btn) {
          var expenseId=$(btn).parents("tr").find(".manage").val();
            localStorage.setItem('expenseId', expenseId);
            $.ajax({
        url: 'http://'+localStorage.getItem('IP')+':'+localStorage.getItem('port')+'/project/expense/downloadExpense',
        data: JSON.stringify({
        commonRequest: {
                         token: localStorage.getItem('token'),
                         userId: localStorage.getItem('userId'),
                         },
                       expenseId: localStorage.getItem('expenseId')
        }),
        contentType: 'application/json',
        type: 'post',
        dataType: 'json',
         success: function (data) {
        $.dynamicSubmit('http://'+localStorage.getItem('IP')+':'+localStorage.getItem('port')+'/file/download',{fileName:data.data.fileName,filePath:data.data.filePath});
        }
      })
    }

    /*
     * 动态构建一个Form 并且提交
    */
    $.dynamicSubmit = function (url, datas) {

        var form = $('#dynamicForm');

        if (form.length <= 0) {
            form = $("<form>");
            form.attr('id', 'dynamicForm');
            form.attr('style', 'display:none');
            form.attr('target', '');
            form.attr('method', 'post');

            $('body').append(form);
        }

        form = $('#dynamicForm');
        form.attr('action', url);
        form.empty();

        if (datas && typeof (datas) == 'object') {
            for (var item in datas) {
                var $_input = $('<input>');
                $_input.attr('type', 'hidden');
                $_input.attr('name', item);
                $_input.val(datas[item]);

                $_input.appendTo(form);
            }
        }

        form.submit();
    }


    function yesPass(btn) {
        localStorage.setItem('expenseId', $(btn).parents("tr").find(".yesId").val());
        $.ajax({
            url: 'http://'+localStorage.getItem('IP')+':'+localStorage.getItem('port')+'/project/expense/auditExpense',
            data: JSON.stringify({
                commonRequest:{
                    token: localStorage.getItem('token'),
                    userId: localStorage.getItem('userId'),
                },
                isPass:1,
                expenseId:localStorage.getItem('expenseId')
            }),
            contentType: 'application/json',
            type: 'post',
            dataType: 'json',
            success: function (data) {
                alert("已通过！");
                location.reload();
            },
            error: function (e) {
                alert("操作失败！");
            }
        })
    }
    function noPass(btn) {
        localStorage.setItem('expenseId', $(btn).parents("tr").find(".nId").val());
        $.ajax({
            url: 'http://'+localStorage.getItem('IP')+':'+localStorage.getItem('port')+'/project/expense/auditExpense',
            data: JSON.stringify({
                commonRequest:{
                    token: localStorage.getItem('token'),
                    userId: localStorage.getItem('userId'),
                },
                isPass:0,
                expenseId:localStorage.getItem('expenseId')
            }),
            contentType: 'application/json',
            type: 'post',
            dataType: 'json',
            success: function (data) {
                alert("已拒绝！");
                location.reload();
            },
            error: function (e) {
                alert("操作失败！");
            }
        })
    }
</script>
