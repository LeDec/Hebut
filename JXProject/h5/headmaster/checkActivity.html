<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>统计签到</title>
    <script type="text/javascript" src="js/jquery-3.2.1.js"></script>
    <!--    兼容浏览器、整体布局-->
    <link rel="stylesheet" href="./css/content.css">
    <!--    头部导航栏-->
    <link rel="stylesheet" href="./css/headNav.css">
    <!--    左侧导航栏样式-->
    <link rel="stylesheet" href="./css/leftNav.css">
    <!--    右侧导航栏样式-->
    <link rel="stylesheet" href="./css/rightNav.css">
    <!--    右侧列表样式-->
    <link rel="stylesheet" href="./css/rightForm.css">
    <!--    左侧导航栏js-->
    <!--    放缩格式-->
    <script type="text/javascript" src="js/scale.js"></script>
    <!--    分页条-->
    <link type="text/css" rel="stylesheet" href="css/page.css" >
    <script type="text/javascript" src="js/page.js"></script>
    <style>
        #check{
            width: 60px;
            height: 25px;
            color: #fff;
            background-color: #6495ED;
            border: none;
            border-radius: 10px;
            box-shadow: 0 2px #27496d;
            position: relative;
            top: 50px;
            left:300px
        }
        #check:hover{
            cursor: pointer;
        }
    </style>
    <script type="text/javascript" src="js/leftNav.js"></script>
    <!--    消息提醒红点-->
    <script type="text/javascript" src="js/news.js"></script>
</head>
<body>
<ul>
    <li><a class="active" href="headmaster.html">匠心训练营</a></li>
    <li style="float:right"><a class="active" href="myInformation.html"><img src="图片/我的头像.png" height="33px" width="33px"></a></li>
    <li style="float:right"><a class="active" href="myNews.html"><img src="图片/消息.png" id="XiaoXi" width="33px" height="33px"></a></li>
</ul>


<div class="content">
    <div class="content-left">
        <!--菜单栏导航-->
        <div class="nav">
            <!--每一个菜单项-->
            <div class="nav-menu">
                <!--主标题-->
                <div class="nav-title"><a href="headmaster.html"> <img src="图片/主页.png" width="17px" height="17px" style="position:relative;left:-40px;top:3px">主页</a></div>
            </div>
            <!--分割线-->
            <div class="seg"></div>

            <div class="nav-menu">
                <!--主标题-->
                <div class="nav-title"><a href="studentRegistrationReview.html"><img src="./图片/报名审核.png" width="17px" height="17px" style="position:relative;left:-26px;top:3px">报名审核</a></div>
            </div>
            <!--分割线-->
            <div class="seg"></div>

            <div class="nav-menu">
                <!--主标题-->
                <div class="nav-title"><img src="图片/学生管理.png" width="17px" height="17px" style="position:relative;left:-26px;top:3px">学生管理</div>
                <div class="nav-content">
                    <a href="studentPersonalInformation.html">学生信息</a>
                </div>
            </div>

            <!--分割线-->
            <div class="seg"></div>

            <div class="nav-menu">
                <!--主标题-->
                <div class="nav-title"><img src="图片/过程管理.png" width="17px" height="17px" style="position:relative;left:-26px;top:3px">过程管理</a></div>
                <div class="nav-contentt">
                    <a href="stageOne.html" style="background:#87CEFA">中期阶段</a>
                    <a href="stageTwo.html">答辩阶段</a>
                    <a href="stageThree.html">后期成果</a>
                </div>
            </div>
            <!--分割线-->
            <div class="seg"></div>

            <div class="nav-menu">
                <!--主标题-->
                <div class="nav-title"><img src="图片/成绩管理.png" width="17px" height="17px" style="position:relative;left:-26px;top:3px">成绩管理</div>
                <div class="nav-content">
                    <a href="scoreEvaluation.html">成绩评定</a>
                    <a href="lookScore.html">查看成绩</a>
                </div>
            </div>
            <!--分割线-->
            <div class="seg"></div>

            <div class="nav-menu">
                <!--主标题-->
                <div class="nav-title"><img src="./图片/报销审核.png" width="17px" height="17px" style="position:relative;left:-26px;top:3px">报销管理</div>
                <div class="nav-content">
                    <a href="reimBursementReview_Project.html">查看报销</a>
                    <a href="reimBursementReviewLook.html">审核报销</a>
                </div>
            </div>
            <!--分割线-->
            <div class="seg"></div>

            <div class="nav-menu">
                <!--主标题-->
                <div class="nav-title"><a href="teachingEvaluation.html"><img src="./图片/教评管理.png" width="17px" height="17px" style="position:relative;left:-26px;top:3px">教评管理</a></div>
            </div>
            <div class="seg"></div>

            <div class="nav-menu">
                <!--主标题-->
                <div class="nav-title"><img src="./图片/通知管理图标.png" width="17px" height="17px" style="position:relative;left:-26px;top:3px">通知管理</div>
                <div class="nav-content">
                    <a href="publishNews.html">发布通知</a>
                    <a href="manageNews.html">查看通知</a>
                </div>
            </div>
            <!--分割线-->
            <div class="seg"></div>

            <div class="nav-menu">
                <!--主标题-->
                <div class="nav-title"><a href="batch.html"><img src="./图片/报名审核.png" width="17px" height="17px" style="position:relative;left:-26px;top:3px">往届匠心班</a></div>
            </div>
        </div>
    </div>
    <div id="secondpaneDiv" class="menu_list">
        <h3 class="menu_head current">统计签到</h3>
    </div>
    <!--右侧内容区-->
    <div class="content-right">
        <table id="yustb2">
            <tr>
                <th width="100"></th>
                <th width="200">序号</th>
                <th width="600">学号</th>
                <th width="600">学生姓名</th>
                <th width="1000">学院</th>
                <th width="1200">专业</th>
            </tr>
        </table>
        <button onclick="opcheckboxed('checkbox', 'checkall')">全选</button>
        <button onclick="opcheckboxed('checkbox', 'uncheckall')">取消全选</button>
        <button onclick="opcheckboxed('checkbox', 'reversecheck')">反选</button>
        <button id="check" onclick="signOnActivity()">确认签到</button>

    </div>
</div>
<div id="pagination" style="position:relative;left:771px;bottom:99px;"></div>

</body>

</html>
<script>
var flag=0;
    //显示所有列表
    $.ajax({
        url: 'http://'+localStorage.getItem('IP')+':'+localStorage.getItem('port')+'/project/activity-user/checkActivityStudent',
        data: JSON.stringify({
            "activityId": localStorage.getItem('activityId'),
            "checkRequest": {
                "commonRequest": {
                    token: localStorage.getItem('token'),
                    userId: localStorage.getItem('userId'),
                },
                "pageRequest": {
                    "currentPage": 1,
                    "pageSize": 999
                },
            }
        }),
        contentType: 'application/json',
        type: 'post',
        dataType: 'json',
        success: function (data) {
        //总页数设置
                Pagination.Init(document.getElementById('pagination'), {
                    size: data.data.pages, // pages size
                    page: 1,// selected page
                    step: 3   // pages before and after current
                });
            var num=1
            for (i in data.data.records) {
                var tk;
                if(data.data.records[i].signStage=="已签到")
                {
                    tk = '<td>' +'<input type="checkbox"  disabled name="checkbox" value="'+data.data.records[i].userId+'">'+ '</td>'+'<td>'  +num+ '</td>'+ '</td>'+'<td>' + data.data.records[i].userId + '</td>' + '<td>' + data.data.records[i].userName + '</td>' + '<td>' + data.data.records[i].institute + '</td>' + '<td>' + data.data.records[i].major + '</td>'

                }else{
                    tk = '<td>' +'<input type="checkbox"  name="checkbox" value="'+data.data.records[i].userId+'">'+ '</td>'+'<td>'  +num+ '</td>'+ '</td>'+'<td>' + data.data.records[i].userId + '</td>' + '<td>' + data.data.records[i].userName + '</td>' + '<td>' + data.data.records[i].institute + '</td>' + '<td>' + data.data.records[i].major + '</td>'
                }
                $("#yustb2").append('<tr>' + tk + '</tr>')
                num++
            }
        }
    })
     function Func() {
        $("#yustb2 tr:not(:first)").remove();//清空
      $.ajax({
          url: 'http://'+localStorage.getItem('IP')+':'+localStorage.getItem('port')+'/project/activity-user/checkActivityStudent',
          data: JSON.stringify({
            "batchId":localStorage.getItem('batchId'),
            "checkRequest": {
                "commonRequest": {
                    token: localStorage.getItem('token'),
                    userId: localStorage.getItem('userId'),
                },
                "pageRequest": {
                    "currentPage":Pagination.page,
                    "pageSize": 11
                },
            }
        }),
        contentType: 'application/json',
        type: 'post',
        dataType: 'json',
        success: function (data) {
        //总页数设置
                Pagination.Init(document.getElementById('pagination'), {
                    size: data.data.pages, // pages size
                    page: Pagination.page,// selected page
                    step: 3   // pages before and after current
                });
            var num=1
            for (i in data.data.records) {
                var tk;
                if(data.data.records[i].signStage=="已签到")
                {
                    tk = '<td>' +'<input type="checkbox" disabled name="checkboxDisabled" value="'+data.data.records[i].userId+'">'+ '</td>'+'<td>'  +num+ '</td>'+ '</td>'+'<td>' + data.data.records[i].userId + '</td>' + '<td>' + data.data.records[i].userName + '</td>' + '<td>' + data.data.records[i].institute + '</td>' + '<td>' + data.data.records[i].major + '</td>'

                }else{
                    tk = '<td>' +'<input type="checkbox" name="checkbox" value="'+data.data.records[i].userId+'">'+ '</td>'+'<td>'  +num+ '</td>'+ '</td>'+'<td>' + data.data.records[i].userId + '</td>' + '<td>' + data.data.records[i].userName + '</td>' + '<td>' + data.data.records[i].institute + '</td>' + '<td>' + data.data.records[i].major + '</td>'
                }
                $("#yustb2").append('<tr>' + tk + '</tr>')
                num++
            }

        }
    })
    }
    function opcheckboxed(objName, type){
        var objNameList=document.getElementsByName(objName);
        if(null!=objNameList){
            for(var i=0;i<objNameList.length;i++){
                if(objNameList[i].checked==true)
                {
                    if(type != 'checkall') {  // 非全选
                        objNameList[i].checked=false;
                    }

                } else {
                    if(type != 'uncheckall') {  // 非取消全选
                        objNameList[i].checked=true;
                    }
                }
            }
        }
    }
    function signOnActivity(){
        var obj = document.getElementsByName('checkbox');
        var list=[];
        for (var i = 0; i < obj.length; i++) {
            if (obj[i].checked) {
                list.push($("input[type='checkbox']:checked").val());
            }
        }
        console.log(list)
        $.ajax({
            url: 'http://'+localStorage.getItem('IP')+':'+localStorage.getItem('port')+'/project/activity-user/signOnActivity',
            data: JSON.stringify({
                    "activityId": localStorage.getItem('activityId'),
                    "commonRequest": {
                        token: localStorage.getItem('token'),
                        userId: localStorage.getItem('userId'),
                    },
                    "studentIdList": list
            }),
            contentType: 'application/json',
            type: 'post',
            dataType: 'json',
            success: function (data) {
                if(data.code==0){
                    alert("操作成功");
                    window.location.href="checkActivity.html";
                }
                else
                alert(data.msg);
            }
        })
    }
</script>


